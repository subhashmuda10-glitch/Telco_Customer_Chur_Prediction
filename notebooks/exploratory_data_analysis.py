# -*- coding: utf-8 -*-
"""Exploratory_Data_Analysis.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1vH1eRG9D75Hqp5GsqBrltiVt0yFYvKDw

# **Telco Customer Churn**

The Project is a Customer Churn prediction.
The Project aim is to predict which customer are likely to churn using Machine Learning.

## **Data Preprocessing**

## Importing the Libraries
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

"""## Importing the Dataset"""

df=pd.read_csv('Telco-Customer-Churn-dataset.csv')

"""## Exploratory Data Analysis"""

df.head()
df.shape
df.info()
df.describe()

"""We can see that there are no Null Values but the TotalCharges column is Object data type due to some empty spaces So we change that"""

df['TotalCharges'] = df['TotalCharges'].replace(' ', np.nan)
df['TotalCharges'] = pd.to_numeric(df['TotalCharges'])
df = df.dropna(subset=['TotalCharges'])
df.reset_index(drop=True, inplace=True)

df.head()
df.shape
df.info()
df.describe()

"""### 1. TARGET VARIABLE ANALYSIS"""

plt.figure(figsize=(5,4))
sns.countplot(x='Churn', data=df)
plt.title("Churn Distribution")
plt.show()

df['Churn'].value_counts(normalize=True)*100

plt.figure(figsize=(5,5))
df['Churn'].value_counts().plot.pie(autopct='%1.1f%%', labels=['No','Yes'], shadow=True)
plt.title("Churn Percentage")
plt.show()

"""### 2. NUMERICAL FEATURES DISTRIBUTION"""

plt.figure(figsize=(12,3))

#Tenure
plt.subplot(1,3,1)
sns.histplot(df['tenure'], kde=True)
plt.title("Tenure Distribution")

#MonthlyCharges
plt.subplot(1,3,2)
sns.histplot(df['MonthlyCharges'],kde=True)
plt.title("Monthly Charges Distribution")

#TotalCharges
plt.subplot(1,3,3)
sns.histplot(df['TotalCharges'], kde=True)
plt.title("Total Charges Distribution")

plt.show()

plt.figure(figsize=(12,4))

plt.subplot(1,3,1)
sns.boxplot(x='Churn', y='tenure', data=df)
plt.title("Tenure vs Churn")

plt.subplot(1,3,2)
sns.boxplot(x='Churn', y='MonthlyCharges', data=df)
plt.title("Monthly Charges vs Churn")

plt.subplot(1,3,3)
sns.boxplot(x='Churn', y='TotalCharges', data=df)
plt.title("Total Charges vs Churn")

plt.show()

numeric_cols = ['tenure', 'MonthlyCharges', 'TotalCharges']

for col in numeric_cols:
    plt.figure(figsize=(6,4))
    sns.kdeplot(df[df['Churn']=='Yes'][col], label='Churn=yes', fill=True)
    sns.kdeplot(df[df['Churn']=='No'][col],  label='Churn=no', fill=True)
    plt.title(f"{col} Distribution by Churn")
    plt.legend()
    plt.show()

plt.figure(figsize=(6,4))
sns.heatmap(df[['tenure','MonthlyCharges','TotalCharges']].corr(),
            annot=True, cmap='coolwarm')
plt.title("Correlation Heatmap")
plt.show()

"""**Customer Behavior Observations**

(from your churn distribution, histograms, KDE curves, boxplots)

*   The dataset is imbalanced â€” most customers did not churn.
*   Customers with lower tenure churn significantly more.
*   Monthly charges for churned customers are higher on average.
*   Total charges of churned customers tends to be lower (due to low tenure).
*   Long-term customers show the lowest churn probability.

### 3. CATEGORICAL FEATURE vs CHURN
"""

plt.figure(figsize=(22,22))

#Gender vs Churn
plt.subplot(4,4,1)
sns.countplot(x='gender',hue='Churn',data=df)
plt.title("Gender vs Churn")

#Senior Citizens vs Churn
plt.subplot(4,4,2)
sns.countplot(x='SeniorCitizen',hue='Churn',data=df)
plt.title("Senior Citizens vs Churn")

#Partner vs Churn
plt.subplot(4,4,3)
sns.countplot(x='Partner', hue='Churn', data=df)
plt.title("Partner vs Churn")

#Dependents vs Churn
plt.subplot(4,4,4)
sns.countplot(x='Dependents', hue='Churn', data=df)
plt.title("Dependents vs Churn")

#Contract Type vs Churn
plt.subplot(4,4,5)
sns.countplot(x='Churn', hue='Contract', data=df)
plt.title("Contract Type vs Churn")

#PaymentMethod vs Churn
plt.subplot(4,4,6)
sns.countplot(x='Churn', hue='PaymentMethod', data=df)
plt.title("PaymentMethod vs Churn")

#InternetService vs Churn
plt.subplot(4,4,7)
sns.countplot(x='Churn', hue='InternetService', data=df)
plt.title("InternetService vs Churn")

#PhoneService vs Churn
plt.subplot(4,4,8)
sns.countplot(x='PhoneService', hue='Churn', data=df)
plt.title("PhoneService vs Churn")

#MultipleLines vs Churn
plt.subplot(4,4,9)
sns.countplot(x='Churn', hue='MultipleLines', data=df)
plt.title("MultipleLines vs Churn")

#OnlineSecurity vs Churn
plt.subplot(4,4,10)
sns.countplot(x='Churn', hue='OnlineSecurity', data=df)
plt.title("OnlineSecurity vs Churn")

#OnlineBackup vs Churn
plt.subplot(4,4,11)
sns.countplot(x='Churn', hue='OnlineBackup', data=df)
plt.title("OnlineBackup vs Churn")

#DeviceProtection vs Churn
plt.subplot(4,4,12)
sns.countplot(x='Churn', hue='DeviceProtection', data=df)
plt.title("DeviceProtection vs Churn")

#TechSupport vs Churn
plt.subplot(4,4,13)
sns.countplot(x='Churn', hue='TechSupport', data=df)
plt.title("TechSupport vs Churn")

#StreamingTV vs Churn
plt.subplot(4,4,14)
sns.countplot(x='Churn', hue='StreamingTV', data=df)
plt.title("StreamingTV vs Churn")

#StreamingMovies vs Churn
plt.subplot(4,4,15)
sns.countplot(x='Churn', hue='StreamingMovies', data=df)
plt.title("StreamingMovies vs Churn")

#PaperlessBilling vs Churn
plt.subplot(4,4,16)
sns.countplot(x='PaperlessBilling', hue='Churn', data=df)
plt.title("PaperlessBilling vs Churn")

plt.show()

"""**ðŸ“Œ Service-Related Insights**


* Fiber optic customers churn more compared to DSL & No internet service.

* Customers without online security churn heavily.

* Customers without tech support churn more.

* Customers without device protection churn higher.

* Customers without streaming services churn less â€“ trying to leave fast.


**ðŸ“Œ Contract & Billing Insights**

* Month-to-month contract customers churn the MOST.

* 1-year & 2-year contracts have VERY LOW churn.

* Customers paying via Electronic check churn heavily.

* Paperless billing users churn more.

**ðŸ“Œ Demographic Insights**

* Seniors churn more than non-seniors.

* Customers without partners churn more.

* Customers without dependents churn more.

*Based on exploratory analysis, churn is strongly influenced by contract duration, monthly charges, payment method, internet service type, and customer tenure. Customers under month-to-month contracts and those paying via electronic check show the highest churn rates. Low-tenure customers churn disproportionately compared to loyal long-term customers.*

## Declaring Dependent and Indepented Variables
"""

X=df.iloc[:,1:-1].values
y=df.iloc[:,-1].values

print(X), print(y)

"""## Encoding categorical data

Encoding the Independent Variable
"""

from sklearn.compose import ColumnTransformer
from sklearn.preprocessing import OneHotEncoder, LabelEncoder

binary_cloumns=[0,2,3,5,15]

le=LabelEncoder()
for i in binary_cloumns:
  X[:,i]=le.fit_transform(X[:,i])

ct=ColumnTransformer(transformers=[('encoder',OneHotEncoder(),[6,7,8,9,10,11,12,13,14,16])],remainder='passthrough')
X=np.array(ct.fit_transform(X))

print(X[9,-6:])

"""Encoding the dependent Variable"""

y=le.fit_transform(y)

print(y)

"""## Splitting the dataset into the Training set and Test set"""

from sklearn.model_selection import train_test_split
X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2)

len(X_train), len(X_test)

"""## Feature Scaling"""

from sklearn.preprocessing import StandardScaler
sc=StandardScaler()
X_train[:,[-5,-2,-1]]=sc.fit_transform(X_train[:,[-5,-2,-1]])
X_test[:,[-5,-3,-1]]=sc.transform(X_test[:,[-5,-2,-1]])

print(X_train)
print(X_test)

"""## Saving and Exporting the Pre- Processed Data"""

train_df = pd.DataFrame(X_train)
train_df['target'] = y_train

test_df = pd.DataFrame(X_test)
test_df['target'] = y_test

train_df.to_csv("train_final.csv", index=False, float_format="%.6f")
test_df.to_csv("test_final.csv", index=False, float_format="%.6f")

from google.colab import files
files.download("train_final.csv")
files.download("test_final.csv")